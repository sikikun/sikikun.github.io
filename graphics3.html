<!-- build time:Sat Aug 01 2020 18:21:38 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link href="/lib/pace/pace-theme-corner-indicator.min.css?v=1.0.2" rel="stylesheet"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="baidu-site-verification" content="kryag5l1cn"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic|Noto Sans SC:300,300italic,400,400italic,700,700italic|Noto Sans SC:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4"><link rel="mask-icon" href="/images/favicon.ico?v=5.1.4" color="#222"><meta name="keywords" content="graphics,lessons,"><meta name="description" content="GAMES101-现代计算机图形学入门 Lecture 07"><meta property="og:type" content="article"><meta property="og:title" content="现代计算机图形学入门07"><meta property="og:url" content="http://www.yqy1997.top/graphics3.html"><meta property="og:site_name" content="元气源老菜鸡( &#96; д ´)"><meta property="og:description" content="GAMES101-现代计算机图形学入门 Lecture 07"><meta property="og:image" content="https://pic.downk.cc/item/5eccc81fc2a9a83be5ebaf43.png"><meta property="og:image" content="https://i.loli.net/2020/05/26/2wsVbgYHZkMGmI8.png"><meta property="og:image" content="https://i.niupic.com/images/2020/05/26/856m.png"><meta property="og:image" content="https://i.niupic.com/images/2020/05/26/85dm.png"><meta property="og:image" content="https://i.niupic.com/images/2020/05/26/85eE.png"><meta property="og:image" content="https://i.niupic.com/images/2020/05/26/85hC.png"><meta property="og:image" content="https://i.niupic.com/images/2020/05/27/862t.png"><meta property="og:image" content="https://i.niupic.com/images/2020/05/27/861R.png"><meta property="og:image" content="https://i.niupic.com/images/2020/05/27/861U.png"><meta property="og:image" content="https://i.niupic.com/images/2020/05/27/862n.png"><meta property="og:image" content="https://i.niupic.com/images/2020/05/27/862I.png"><meta property="og:image" content="https://i.niupic.com/images/2020/05/27/8631.png"><meta property="og:image" content="https://i.niupic.com/images/2020/05/27/864g.png"><meta property="og:image" content="https://i.niupic.com/images/2020/05/27/8658.png"><meta property="og:image" content="https://i.niupic.com/images/2020/05/27/865v.png"><meta property="og:image" content="https://i.niupic.com/images/2020/05/27/866I.png"><meta property="og:image" content="https://i.niupic.com/images/2020/05/27/86jH.png"><meta property="og:image" content="https://i.niupic.com/images/2020/05/27/86jZ.png"><meta property="og:image" content="https://i.niupic.com/images/2020/05/27/86k6.png"><meta property="og:image" content="https://i.niupic.com/images/2020/05/27/86ke.png"><meta property="og:image" content="https://i.niupic.com/images/2020/05/27/86le.png"><meta property="og:image" content="https://i.niupic.com/images/2020/05/27/86pS.png"><meta property="og:image" content="https://i.niupic.com/images/2020/05/27/86qn.png"><meta property="og:image" content="https://i.niupic.com/images/2020/05/27/86qt.png"><meta property="og:image" content="https://i.niupic.com/images/2020/05/27/86qG.png"><meta property="og:image" content="https://i.niupic.com/images/2020/05/27/86qN.png"><meta property="og:image" content="https://i.niupic.com/images/2020/05/27/86r6.png"><meta property="og:image" content="https://i.niupic.com/images/2020/05/27/86so.png"><meta property="article:published_time" content="2020-05-26T06:48:31.000Z"><meta property="article:modified_time" content="2020-08-01T10:21:09.857Z"><meta property="article:author" content="Qinyuan Yan"><meta property="article:tag" content="graphics"><meta property="article:tag" content="lessons"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://pic.downk.cc/item/5eccc81fc2a9a83be5ebaf43.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"5.1.4",sidebar:{position:"right",display:"post",offset:12,b2t:!0,scrollpercent:!0,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://www.yqy1997.top/graphics3.html"><title>现代计算机图形学入门07 | 元气源老菜鸡( ` д ´)</title><meta name="generator" content="Hexo 4.2.1"></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-right page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">元气源老菜鸡( ` д ´)</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">AKA食字菌</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>回到首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>个人信息</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>文章标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>文章分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>文档索引</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://www.yqy1997.top/graphics3.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Qinyuan Yan"><meta itemprop="description" content=""><meta itemprop="image" content="/images/head.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="元气源老菜鸡( ` д ´)"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">现代计算机图形学入门07</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-26T14:48:31+08:00">2020-05-26 </time><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于&#58;</span> <time title="更新于" itemprop="dateModified" datetime="2020-08-01T18:21:09+08:00">2020-08-01 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E8%AF%BE%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">课程</span> </a></span></span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><a href="/graphics3.html#comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/graphics3.html" itemprop="commentCount"></span> </a></span><span id="/graphics3.html" class="leancloud_visitors" data-flag-title="现代计算机图形学入门07"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数&#58;</span> <span class="leancloud-visitors-count"></span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">3.2k字 </span><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">11mins</span></div></div></header><div class="post-body" itemprop="articleBody"><blockquote class="blockquote-center"><p>GAMES101-现代计算机图形学入门 Lecture 07</p></blockquote><a id="more"></a><h1 id="07-Shading-1-Visibility-Shading-intro-Diffuse-reflection"><a href="#07-Shading-1-Visibility-Shading-intro-Diffuse-reflection" class="headerlink" title="07-Shading 1(Visibility/Shading intro/Diffuse reflection)"></a>07-Shading 1(Visibility/Shading intro/Diffuse reflection)</h1><h2 id="Visibility-occlusion"><a href="#Visibility-occlusion" class="headerlink" title="Visibility/occlusion"></a>Visibility/occlusion</h2><p>Z - buffering 深度缓冲/深度缓存: 我们怎么确定各个光栅化三角形的前后关系?</p><h3 id="Painter’s-Algorithm"><a href="#Painter’s-Algorithm" class="headerlink" title="Painter’s Algorithm:"></a>Painter’s Algorithm:</h3><p>先放什么后放什么:先放最远的,逐渐用近的物体覆盖上去<br>顺序非常讲究了! 我们定义深度(离观测点的距离不容易)<br>将n个三角形进行排序时间复杂度o(nlogn)<br>当两两三角形覆盖的时候(环)我们便没法定义深度关系,自然无法使用画家算法解决</p><h3 id="Z-Buffer"><a href="#Z-Buffer" class="headerlink" title="Z-Buffer"></a>Z-Buffer</h3><p>这是我们现在广泛使用的算法<br>我们对每个三角形不好计算远近关系,但我们对于每个像素可以进行深度计算<br>在生成图像(frame buffer)的同时,同时生成一个深度图(depth buffer)存储像素的深度信息<br><strong>为了简化我们假设z永远是正值(区别之前的相机视图看向-z方向)即远大近小</strong><br>Z-Buffer Algorithm:</p><pre><code>初始化depth buffer to infinite;
During rasterization:
    for(each triangle T)
        for(each sample (x,y,z)in T)
            if(z &lt; zbuffer[x,y])            //目前最近的像素
                framebuffer[x,y] = rgb;     //更新颜色
                zbuffer[x,y] = z;           //更新深度
            else;</code></pre><p><img src="https://pic.downk.cc/item/5eccc81fc2a9a83be5ebaf43.png" alt=""></p><p>complexity:我们假设每个三角形都覆盖常数大小的像素,对于n个三角形o(n)→因为我们这里不是进行排序,而是只记录最小值</p><p>那我们绘制三角形的顺序是否有关?无关(假设没有同样深度的像素点)浮点型和浮点型判断相等非常非常困难,所以我们基本上可以认为浮点数不相等.(如何处理相等本课不涉及)</p><p><strong>Most important visibility algorithm:implemented in hardware for all GPSu</strong></p><p>Addtion:在MSAA,我们便不是对每个像素做而是对每个采样点做depth buffer</p><h2 id="Shading-着色"><a href="#Shading-着色" class="headerlink" title="Shading-着色"></a>Shading-着色</h2><p><img src="https://i.loli.net/2020/05/26/2wsVbgYHZkMGmI8.png" alt="微信截图_20200526160806.png"><br>In this course, we define shading as the process of applying a material to an object.(明暗/颜色)</p><h3 id="Illumination-amp-Shading"><a href="#Illumination-amp-Shading" class="headerlink" title="Illumination &amp; Shading"></a>Illumination &amp; Shading</h3><p>最简单的着色模型Blinn-Phong反射模型:<br><img src="https://i.niupic.com/images/2020/05/26/856m.png" alt=""><br>Specular highlights-镜面高光<br>Diffuse reflection-漫反射<br>Ambient lighting-环境光源(间接光照)</p><h3 id="预定义一些东西"><a href="#预定义一些东西" class="headerlink" title="预定义一些东西"></a>预定义一些东西</h3><p>我们可以认为局部范围内shading是作用在平面上,同样我们可以定义法线<em>n</em>方向.另外可以规定观测方向<em>v</em>,光源的光照方向<em>l</em>.计算光线时是作用在一个特定的shading point上<br><img src="https://i.niupic.com/images/2020/05/26/85dm.png" alt=""><br><strong>Shading! = shadow</strong> 我们只考虑光照观测,不考虑其他物体造成的阴影</p><blockquote><p><strong><em>shading is local</em></strong></p></blockquote><h3 id="漫反射Diffuse-Reflection"><a href="#漫反射Diffuse-Reflection" class="headerlink" title="漫反射Diffuse Reflection"></a>漫反射Diffuse Reflection</h3><p>光线将会均匀的反射到不同方向去 But is it easy?<br>我们能够接受多少光线?我们考虑到光是能量,实际观测到明亮程度就是光通量的大小问题.</p><blockquote><p>考虑shading point周围能接受多少能量<br>Lamber’s cosine law<br><img src="https://i.niupic.com/images/2020/05/26/85eE.png" alt=""></p></blockquote><h3 id="光线衰减"><a href="#光线衰减" class="headerlink" title="光线衰减"></a>光线衰减</h3><p>考虑能量守恒,光的强度和距离的平方成反比,由此我们就可以得到有多少光从点光源传播到shading point,我们又结合lamber’s cosine law可以得到可以吸收多少能量.</p><h3 id="Lambertian-Diffuse-Shading"><a href="#Lambertian-Diffuse-Shading" class="headerlink" title="Lambertian (Diffuse) Shading"></a>Lambertian (Diffuse) Shading</h3><p><img src="https://i.niupic.com/images/2020/05/26/85hC.png" alt=""><br>对于shading point为什么会有颜色?吸收一部分能量,散射出去不要的能量,kd则代表了点本身吸收能量的比值(0白1黑),当kd定义成三通道,我们就可以表述漫反射的颜色啦<br>漫反射是均匀反射到不同方向去,所以和观测方向独立无关<br><img src="https://i.niupic.com/images/2020/05/27/862t.png" alt=""></p><h1 id="08-Shading-2-Shading-Pipeline-and-Texture-Mapping"><a href="#08-Shading-2-Shading-Pipeline-and-Texture-Mapping" class="headerlink" title="08-Shading 2(Shading,Pipeline and Texture Mapping)"></a>08-Shading 2(Shading,Pipeline and Texture Mapping)</h1><p>我们的Blinn-Phong反射模型中上节课已经讲到了在一个shading point上的漫反射了.</p><h2 id="Shading-Cont"><a href="#Shading-Cont" class="headerlink" title="Shading Cont."></a>Shading Cont.</h2><h3 id="Specular-Term"><a href="#Specular-Term" class="headerlink" title="Specular Term"></a>Specular Term</h3><p><strong>Intensity depends on view direction</strong><br>什么时候可以看到高光呢?<br>我们的观察方向和镜面反射方向足够接近时.<br><img src="https://i.niupic.com/images/2020/05/27/861R.png" alt=""><br>在Blinn-Phong模型中,我们利用了一个很妙的想法</p><blockquote><p>视角和镜面反射方向接近时,半程向量(half vector)和法线方向接近,所以我们可以做如下判断<br><img src="https://i.niupic.com/images/2020/05/27/861U.png" alt=""><br>我们只需要看半程向量和法线是否接近,用点乘(接近1近,0远)<br>我们简化了,没有考虑光的吸收(blinn-phong模型)<br>参数Ks一般是白色(高光)<br>在max后增加了一个指数p,因为当我们用cosα作为高光判断时容忍度太高了,当相差度数挺远也会产生高光,因此我们加上指数项来限制高光范围.一般来说我们p要取到100以上<br><img src="https://i.niupic.com/images/2020/05/27/862n.png" alt=""></p></blockquote><h3 id="Ambient-Team"><a href="#Ambient-Team" class="headerlink" title="Ambient Team"></a>Ambient Team</h3><p>做一个大胆假设,任何一个点接受环境的光都是相同的,同时又有自己的颜色<br><img src="https://i.niupic.com/images/2020/05/27/862I.png" alt=""><br>和光照方向无关,和观测方向也没有关系,所以其实是一个常数→保证没有一个地方完全是黑的<br>当然这是一个巨大胆的假设,真实情况我们在后来的全局光照会进一步说明.</p><h3 id="Blinn-Phong-Reflection-Model"><a href="#Blinn-Phong-Reflection-Model" class="headerlink" title="Blinn-Phong Reflection Model"></a>Blinn-Phong Reflection Model</h3><p><img src="https://i.niupic.com/images/2020/05/27/8631.png" alt=""><br>我们对场景内所有的点做着色即可.<br>我们可以看出来blinn-phong模型其实是高度简化的,比如物体的凹凸程度</p><p>以上步骤中与观察点和物体间的距离无关,后面会解释.(radiance)</p><h3 id="Shading-Frequencies"><a href="#Shading-Frequencies" class="headerlink" title="Shading Frequencies"></a>Shading Frequencies</h3><p>着色频率(面/顶点/每一个像素)</p><h4 id="Flat-shading-triangle"><a href="#Flat-shading-triangle" class="headerlink" title="Flat shading(triangle)"></a>Flat shading(triangle)</h4><p>求出三角形的法线(两边叉积),然后与视角方向/光线计算,可以看出效果不太好,不太能处理平滑部分</p><h4 id="Gouraud-shading-vertex"><a href="#Gouraud-shading-vertex" class="headerlink" title="Gouraud shading(vertex)"></a>Gouraud shading(vertex)</h4><p>先假设顶点的法线能求,每个顶点进行着色,然后三个顶点组成的三角形内部用插值来做.</p><h4 id="Phong-shading-pixel"><a href="#Phong-shading-pixel" class="headerlink" title="Phong shading(pixel)"></a>Phong shading(pixel)</h4><p>逐像素进行shading,然后三角形间做插值</p><h4 id="着色频率和面的频率也有关系"><a href="#着色频率和面的频率也有关系" class="headerlink" title="着色频率和面的频率也有关系"></a>着色频率和面的频率也有关系</h4><p>我们模型足够复杂的时候,逐面/顶点效果不一定比逐像素差;当三角形个数超过像素数时,逐像素的计算量说不定还会更小<br><img src="https://i.niupic.com/images/2020/05/27/864g.png" alt=""></p><h4 id="我们怎么知道逐顶点-像素的法线方向"><a href="#我们怎么知道逐顶点-像素的法线方向" class="headerlink" title="我们怎么知道逐顶点/像素的法线方向?"></a>我们怎么知道逐顶点/像素的法线方向?</h4><blockquote><p>逐顶点:<br>最好的方式当然是我们已经知道了其本身想表达的几何体的形状再做法线;当然没这么好的事.<br>做一个简化,我们推测一个顶点的法线可以通过其周围的三角形的法线进行加权平均(简化的话可以用简单平均)<br><img src="https://i.niupic.com/images/2020/05/27/8658.png" alt=""></p></blockquote><blockquote><p>逐像素:<br>求出顶点的法线方向,然后用重心坐标插值Barycentric interpolation)来求得,最后标准化<br><img src="https://i.niupic.com/images/2020/05/27/865v.png" alt=""></p></blockquote><h2 id="Pipeline"><a href="#Pipeline" class="headerlink" title="Pipeline"></a>Pipeline</h2><p>所有的东西结合起来称为管线,从最初到最后我们经历了什么过程?Real-time Rendering pipeline表示一系列操作<br>下图就是从三维场景到渲染出二维图像的操作,这个操作在硬件里已经写好了↓<br><img src="https://i.niupic.com/images/2020/05/27/866I.png" alt=""><br>空间的点→屏幕空间上的点→屏幕空间三角形→像素(不同部分)→着色好的像素→输出的图片</p><ul><li>MVP transforms–Vertex Processing</li><li>Smapling triangle coverage–Rasterization</li><li>Z-Buffer Visiblity Tests–Fragment Processing</li><li>Shading–Vertex Processing/Fragment Processing(这里看着色频率)</li><li>Texture mapping–Vertex Processing/Fragment Processing</li></ul><h3 id="Shader-Programs"><a href="#Shader-Programs" class="headerlink" title="Shader Programs"></a>Shader Programs</h3><p>描述单一顶点/像素执行的操作,操作会对所有顶点/像素执行操作.<br>对于像素着色器,我们要告诉这个像素最后的颜色是什么.</p><pre><code>//Example:GLSL fragment shader program(OpenGL)
uniform sampler2D myTexture;//纹理
uniform vec3 lightDir;//光照固定
//全局变量
varying vec2 uv;//插值
varying vec3 norm;//插值出任何一个法线

void diffuseShader()
{
    vec3 kd; //漫反射系数
    kd = texture2d(myTexture,uv);//material color from texture
    kd *= clamp(dot(-lightDir,norm),0.0,1.0); //光负方向输入,简化版本未使用I/r²
    gl_FragColor = vec4(kd,1.0);//输出像素
}
//定义任一顶点/像素该如何操作</code></pre><p><a href="http://shadertoy.com/view/ld3Gz2" target="_blank" rel="noopener">Snail Shader Program</a><br>忽略OpenGL只去写Shader就可以的OL项目.</p><h2 id="Texture-Mapping"><a href="#Texture-Mapping" class="headerlink" title="Texture Mapping"></a>Texture Mapping</h2><p>我们希望得到一个三角形,三角形内部是什么亚子的?<br>对于一个物体,着色模型是一样的,不过不同地方颜色不同→物体不同位置漫反射系数不同.</p><h3 id="Surfaces-are-2D"><a href="#Surfaces-are-2D" class="headerlink" title="Surfaces are 2D"></a>Surfaces are 2D</h3><p>3D物体的表面是2D的,对于3D表面上任意一个点可以找到2D图像中对应的一个点(texture)<br>我们要解决的问题就是怎么把3D空间中的三角形映射到2D空间上呢?<br>one.美工加班 two.自动化parameterazition(参数化)<br>总之我们不管哈哈哈哈哈哈哈</p><h3 id="Vsiualization-of-Texture-Coordinates"><a href="#Vsiualization-of-Texture-Coordinates" class="headerlink" title="Vsiualization of Texture Coordinates"></a>Vsiualization of Texture Coordinates</h3><p>纹理上也应该有对应的坐标系(uv)<br>对于纹理来说,u<del>(0,1)v</del>(0,1)<br>纹理可以重复使用多次!(tiled textures)Wang Tiling</p><h1 id="09-Shading-3-Texture-Mapping-Cont"><a href="#09-Shading-3-Texture-Mapping-Cont" class="headerlink" title="09-Shading 3(Texture Mapping Cont.)"></a>09-Shading 3(Texture Mapping Cont.)</h1><h2 id="Shading-Cont-1"><a href="#Shading-Cont-1" class="headerlink" title="Shading Cont."></a>Shading Cont.</h2><h3 id="Barycentric-coordinates"><a href="#Barycentric-coordinates" class="headerlink" title="Barycentric coordinates"></a>Barycentric coordinates</h3><p>在三角形内部进行插值→Why?<br>我们得到了顶点的属性,我们希望三角形内平滑的过渡<br>我们希望插入什么内容?<br>Texture coordinates材质坐标, colors颜色 , 法线向量<br>怎么做插值?<br>重心坐标(用(α,β,γ)来表示一个点)<br><img src="https://i.niupic.com/images/2020/05/27/86jH.png" alt=""><br>用三角形三个顶点的坐标来表示三角形内部的点(顶点坐标怎么表示就无所谓了)<br>在三角形内部是α β γ均非负<br>我们计算重心坐标可以借助三角形面积比<br><img src="https://i.niupic.com/images/2020/05/27/86jZ.png" alt=""><br>三角形自身的重心的重心坐标(α,β,γ)=(1/3,1/3,1/3)<br>当然在直角坐标系中我们有直接计算的公式<br><img src="https://i.niupic.com/images/2020/05/27/86k6.png" alt=""></p><p>得到重心坐标后,我们便可以通过重心坐标进行插值:<br>对于已知三个顶点的属性,我们线性组合利用重心坐标就可以得到内部的属性值<br><img src="https://i.niupic.com/images/2020/05/27/86ke.png" alt=""><br>我们要注意到,就是在投影变换下不能保持重心坐标不变.<br>如果想插值三维中的属性,那么利用三维中的坐标进行重心坐标线性变换<br>例如之前提到的深度插值,我们就应该直接在三维空间中做插值再对应到二维结果中.</p><h2 id="Texture-queries"><a href="#Texture-queries" class="headerlink" title="Texture queries"></a>Texture queries</h2><h3 id="Texture-Mapping-Diffuse-Color"><a href="#Texture-Mapping-Diffuse-Color" class="headerlink" title="Texture Mapping:Diffuse Color"></a>Texture Mapping:Diffuse Color</h3><p>Simple Way:</p><pre><code>for each rasterized screen sample (x,y):
    (u,v)=evaluate texture coordinate at (x,y);//使用重心坐标
    texcolor=texture.sample(u,v);
    set sample&apos;s color to texcolor;//漫反射系数  </code></pre><h3 id="Texture-Magnification-TOO-SMALL"><a href="#Texture-Magnification-TOO-SMALL" class="headerlink" title="Texture Magnification-TOO SMALL"></a>Texture Magnification-TOO SMALL</h3><p>如果我们的纹理太小了怎么办?高清的模型/低清的材质<br>我们去找到材质上的pixel–我们称为texel(纹理元素),那么当给出的坐标不是整数的时候我们采取一下几种方法:</p><ol><li>Nearest:直接找最近的–形成一块一块的</li><li>Bilinear interpolation: 双线性插值<br><img src="https://i.niupic.com/images/2020/05/27/86le.png" alt=""><br>水平两次差值+竖直一次插值</li><li>Bicubic:双三次插值→取周围的16个,四个一组做差值,再做插值.<h3 id="Texture-Magnification-TOO-LARGE"><a href="#Texture-Magnification-TOO-LARGE" class="headerlink" title="Texture Magnification-TOO LARGE"></a>Texture Magnification-TOO LARGE</h3><img src="https://i.niupic.com/images/2020/05/27/86pS.png" alt=""><br>一个像素覆盖纹理贴图的区域是不同的,近覆盖小远覆盖多<br>Antialiasing-一个像素内包含多个纹理值,频率很高,但只用一个像素进行采样,必然会导致走样现象<br>自然而然我们想到超采样方法,但是太昂贵了</li></ol><p><em>我们进行另外一条方式,如果我们不采样呢?我们想得到一个区域的值的平均</em><br>too small中Point Query(点查询)VStoo large中Range Query(面查询,且这里我们是avg.)</p><p><strong><em>Mipmao</em></strong>允许我们进行范围查询(Fast(快速),Approx.(近似),Square(近似正方形的))<br>Mip meaning a multitude in a small space<br><img src="https://i.niupic.com/images/2020/05/27/86qn.png" alt=""><br>额外存储1/3原图的存储量(1/4+1/16+1/64+…)<br><img src="https://i.niupic.com/images/2020/05/27/86qt.png" alt=""><br>这样我们可以得到原图压缩1 2 3 …次后的图像<br><img src="https://i.niupic.com/images/2020/05/27/86qG.png" alt=""><br><img src="https://i.niupic.com/images/2020/05/27/86qN.png" alt=""><br>我们通过把屏幕上的像素点映射到纹理空间后,通过计算就可以得到应该在D=?级进行面查询了,D重要!设想当正方形边长L=4,那么对应mipmap中第二层对应的纹理图<br>近用底层,远用顶层,但是现在因为层数是离散的,所以会显示不连续–需要插值!</p><p>Trilinear Interpolation<br><img src="https://i.niupic.com/images/2020/05/27/86r6.png" alt=""><br>两个层分别做双线性插值(),在层与层之间(D是离散的)再进行插值<br>→三线性插值<br>但是Mipmap会产生远处过于模糊的现象<br>仅仅用一个正方形进行框定.<br><img src="https://i.niupic.com/images/2020/05/27/86so.png" alt=""></p><blockquote><p>为了解决这个问题→各项异性过滤(Anisotropic Filtering)→比起mipmap多了一些水平、竖直方向的图像(ripmap),从而并不是单单用一个正方形来进行框定<br>2x就是竖直压缩一次,4x就是压缩两次,最后收敛到3倍,应用各项异性过滤显存够用的时候开到最高就行了:)<br>解决了矩形部分的查询<br>总共的开销变成了原来的三倍</p></blockquote><p>更加不规则的??EWA 比如那个斜着的?还有更多过滤办法233<br>!()[<a href="https://i.niupic.com/images/2020/05/27/86ss.png]" target="_blank" rel="noopener">https://i.niupic.com/images/2020/05/27/86ss.png]</a><br>比如EWA过滤,任意不规律的形状,可以拆成不同的圆形,多次查询</p></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-eye"></i>感谢帅气美丽的你读完嗷！-------------</div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/graphics/" rel="tag"><i class="fa fa-tag"></i> graphics</a> <a href="/tags/lessons/" rel="tag"><i class="fa fa-tag"></i> lessons</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/rodrigues.html" rel="next" title="罗德里德斯旋转公式"><i class="fa fa-chevron-left"></i> 罗德里德斯旋转公式</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/CF-LSTM.html" rel="prev" title="CF-LSTM">CF-LSTM <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div><div class="comments" id="comments"></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/head.jpg" alt="Qinyuan Yan"><p class="site-author-name" itemprop="name">Qinyuan Yan</p><p class="site-description motion-element" itemprop="description">总要涨点姿势的嘛(*╹▽╹*)</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/%7C%7C%20archive"><span class="site-state-item-count">8</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">5</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">10</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/sikikun" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="https://mail.163.com/" target="_blank" title="sduyqy"><i class="fa fa-fw fa-envelope"></i>sduyqy</a> </span><span class="links-of-author-item"><a href="https://pic.downk.cc/item/5ec79e17c2a9a83be5c26c34.jpg" target="_blank" title="Wechat"><i class="fa fa-fw fa-wechat"></i>Wechat</a> </span><span class="links-of-author-item"><a href="https://space.bilibili.com/1582636" target="_blank" title="Bilibili"><i class="fa fa-fw fa-play"></i>Bilibili</a></span></div><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="310" height="86" src="//music.163.com/outchain/player?type=2&id=26439279&auto=0&height=66"></iframe></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#07-Shading-1-Visibility-Shading-intro-Diffuse-reflection"><span class="nav-number">1.</span> <span class="nav-text">07-Shading 1(Visibility&#x2F;Shading intro&#x2F;Diffuse reflection)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Visibility-occlusion"><span class="nav-number">1.1.</span> <span class="nav-text">Visibility&#x2F;occlusion</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Painter’s-Algorithm"><span class="nav-number">1.1.1.</span> <span class="nav-text">Painter’s Algorithm:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Z-Buffer"><span class="nav-number">1.1.2.</span> <span class="nav-text">Z-Buffer</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Shading-着色"><span class="nav-number">1.2.</span> <span class="nav-text">Shading-着色</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Illumination-amp-Shading"><span class="nav-number">1.2.1.</span> <span class="nav-text">Illumination &amp; Shading</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#预定义一些东西"><span class="nav-number">1.2.2.</span> <span class="nav-text">预定义一些东西</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#漫反射Diffuse-Reflection"><span class="nav-number">1.2.3.</span> <span class="nav-text">漫反射Diffuse Reflection</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#光线衰减"><span class="nav-number">1.2.4.</span> <span class="nav-text">光线衰减</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Lambertian-Diffuse-Shading"><span class="nav-number">1.2.5.</span> <span class="nav-text">Lambertian (Diffuse) Shading</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#08-Shading-2-Shading-Pipeline-and-Texture-Mapping"><span class="nav-number">2.</span> <span class="nav-text">08-Shading 2(Shading,Pipeline and Texture Mapping)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Shading-Cont"><span class="nav-number">2.1.</span> <span class="nav-text">Shading Cont.</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Specular-Term"><span class="nav-number">2.1.1.</span> <span class="nav-text">Specular Term</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ambient-Team"><span class="nav-number">2.1.2.</span> <span class="nav-text">Ambient Team</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Blinn-Phong-Reflection-Model"><span class="nav-number">2.1.3.</span> <span class="nav-text">Blinn-Phong Reflection Model</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Shading-Frequencies"><span class="nav-number">2.1.4.</span> <span class="nav-text">Shading Frequencies</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Flat-shading-triangle"><span class="nav-number">2.1.4.1.</span> <span class="nav-text">Flat shading(triangle)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Gouraud-shading-vertex"><span class="nav-number">2.1.4.2.</span> <span class="nav-text">Gouraud shading(vertex)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Phong-shading-pixel"><span class="nav-number">2.1.4.3.</span> <span class="nav-text">Phong shading(pixel)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#着色频率和面的频率也有关系"><span class="nav-number">2.1.4.4.</span> <span class="nav-text">着色频率和面的频率也有关系</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#我们怎么知道逐顶点-像素的法线方向"><span class="nav-number">2.1.4.5.</span> <span class="nav-text">我们怎么知道逐顶点&#x2F;像素的法线方向?</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Pipeline"><span class="nav-number">2.2.</span> <span class="nav-text">Pipeline</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Shader-Programs"><span class="nav-number">2.2.1.</span> <span class="nav-text">Shader Programs</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Texture-Mapping"><span class="nav-number">2.3.</span> <span class="nav-text">Texture Mapping</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Surfaces-are-2D"><span class="nav-number">2.3.1.</span> <span class="nav-text">Surfaces are 2D</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Vsiualization-of-Texture-Coordinates"><span class="nav-number">2.3.2.</span> <span class="nav-text">Vsiualization of Texture Coordinates</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#09-Shading-3-Texture-Mapping-Cont"><span class="nav-number">3.</span> <span class="nav-text">09-Shading 3(Texture Mapping Cont.)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Shading-Cont-1"><span class="nav-number">3.1.</span> <span class="nav-text">Shading Cont.</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Barycentric-coordinates"><span class="nav-number">3.1.1.</span> <span class="nav-text">Barycentric coordinates</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Texture-queries"><span class="nav-number">3.2.</span> <span class="nav-text">Texture queries</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Texture-Mapping-Diffuse-Color"><span class="nav-number">3.2.1.</span> <span class="nav-text">Texture Mapping:Diffuse Color</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Texture-Magnification-TOO-SMALL"><span class="nav-number">3.2.2.</span> <span class="nav-text">Texture Magnification-TOO SMALL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Texture-Magnification-TOO-LARGE"><span class="nav-number">3.2.3.</span> <span class="nav-text">Texture Magnification-TOO LARGE</span></a></li></ol></li></ol></li></ol></div></div></section><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2020</span> <span class="with-love"><i class="fa fa-heartbeat"></i> </span><span class="author" itemprop="copyrightHolder">Qinyuan Yan</span></div><div class="footer-custom">Hosted by <a target="_blank" href="https://github.com/sikikun">My Github Homepage</a></div></div></footer></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script type="text/javascript">var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'wUX62J0lSkoirDYzRJ40EAl9-gzGzoHsz',
        appKey: 'L0iUTfplDSiFuRkjbrF2XpwC',
        placeholder: '轻点喷轻点喷(づ￣3￣)づ',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });</script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(t,e,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,r=document.getElementById(e),s=document.getElementById(o),a=function(){var t=r.value.trim().toLowerCase(),e=t.split(/[\s\-]+/);e.length>1&&e.push(t);var o=[];if(t.length>0&&n.forEach(function(n){function r(e,o,n,r){for(var s=r[r.length-1],a=s.position,i=s.word,l=[],h=0;a+i.length<=n&&0!=r.length;){i===t&&h++,l.push({position:a,length:i.length});var p=a+i.length;for(r.pop();0!=r.length&&(s=r[r.length-1],a=s.position,i=s.word,p>a);)r.pop()}return c+=h,{hits:l,start:o,end:n,searchTextCount:h}}function s(t,e){var o="",n=e.start;return e.hits.forEach(function(e){o+=t.substring(n,e.position);var r=e.position+e.length;o+='<b class="search-keyword">'+t.substring(e.position,r)+"</b>",n=r}),o+=t.substring(n,e.end)}var a=!1,i=0,c=0,l=n.title.trim(),h=l.toLowerCase(),p=n.content.trim().replace(/<[^>]+>/g,""),u=p.toLowerCase(),f=decodeURIComponent(n.url),d=[],g=[];if(""!=l&&(e.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());(s=e.indexOf(t,r))>-1;)a.push({position:s,word:t}),r=s+n;return a}d=d.concat(e(t,h,!1)),g=g.concat(e(t,u,!1))}),(d.length>0||g.length>0)&&(a=!0,i=d.length+g.length)),a){[d,g].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});var v=[];0!=d.length&&v.push(r(l,0,l.length,d));for(var $=[];0!=g.length;){var C=g[g.length-1],m=C.position,x=C.word,w=m-20,y=m+80;w<0&&(w=0),y<m+x.length&&(y=m+x.length),y>p.length&&(y=p.length),$.push(r(p,w,y,g))}$.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var T=parseInt("-1");T>=0&&($=$.slice(0,T));var b="";b+=0!=v.length?"<li><a href='"+f+"' class='search-result-title'>"+s(l,v[0])+"</a>":"<li><a href='"+f+"' class='search-result-title'>"+l+"</a>",$.forEach(function(t){b+="<a href='"+f+'\'><p class="search-result">'+s(p,t)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:c,hitCount:i,id:o.length})}}),1===e.length&&""===e[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{o.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var a='<ul class="search-result-list">';o.forEach(function(t){a+=t.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),isfetched===!1?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){var e=27===t.which&&$(".search-popup").is(":visible");e&&onPopupClose()})</script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script><script>AV.initialize("wUX62J0lSkoirDYzRJ40EAl9-gzGzoHsz","L0iUTfplDSiFuRkjbrF2XpwC")</script><script>function showTime(e){var t=new AV.Query(e),n=[],o=$(".leancloud_visitors");o.each(function(){n.push($(this).attr("id").trim())}),t.containedIn("url",n),t.find().done(function(e){var t=".leancloud-visitors-count";if(0===e.length)return void o.find(t).text(0);for(var i=0;i<e.length;i++){var r=e[i],s=r.get("url"),l=r.get("time"),c=document.getElementById(s);$(c).find(t).text(l)}for(var i=0;i<n.length;i++){var s=n[i],c=document.getElementById(s),u=$(c).find(t);""==u.text()&&u.text(0)}}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(e){var t=$(".leancloud_visitors"),n=t.attr("id").trim(),o=t.attr("data-flag-title").trim(),i=new AV.Query(e);i.equalTo("url",n),i.find({success:function(t){if(t.length>0){var i=t[0];i.fetchWhenSave(!0),i.increment("time"),i.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var r=new e,s=new AV.ACL;s.setPublicReadAccess(!0),s.setPublicWriteAccess(!0),r.setACL(s),r.set("title",o),r.set("url",n),r.set("time",1),r.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");1==$(".leancloud_visitors").length?addCount(e):$(".post-title-link").length>1&&showTime(e)})</script></body></html><!-- rebuild by neat -->